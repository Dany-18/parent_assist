<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { font-family: Arial, sans-serif; background: #eef2f3; margin: 0; text-align: center; }
    .report {
        background: white; padding: 30px; border-radius: 12px;
        max-width: 650px; margin: 50px auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2); text-align: left;
    }
    h2 { text-align: center; margin-bottom: 25px; }
    .field { margin: 12px 0; font-size: 18px; }
    strong { display: inline-block; width: 140px; }
    img { width: 120px; display: block; margin: 0 auto 20px; }
    .logout-btn {
        display: block;
        width: 120px;
        margin: 20px auto 0;
        padding: 10px;
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 8px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
    }
    .logout-btn:hover { background-color: #b02a37; }
</style>
</head>
<body>
    <div class="report">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="VELS Logo">
        <h2>ðŸ“– Student Report</h2>
        <div class="field"><strong>Roll Number:</strong> {{ rollno }}</div>
        <div class="field"><strong>Name:</strong> {{ name }}</div>
        <div class="field"><strong>Department:</strong> {{ department }}</div>
        <div class="field"><strong>Marks:</strong> {{ marks }}</div>
        <div class="field"><strong>Remarks:</strong> {{ remarks }}</div>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>

    <!-- ðŸŽ™ï¸ Fully Voice-Based AI -->
    <audio id="audio" autoplay hidden></audio>
    <script>
    const lang = "{{ lang }}";
    const audio = document.getElementById("audio");

    // Greetings in each language
    const greetings = {
        "ta": "à®µà®£à®•à¯à®•à®®à¯! à®‰à®™à¯à®•à®³à¯à®•à¯à®•à¯ à®‰à®¤à®µà®¿ à®µà¯‡à®£à¯à®Ÿà¯à®®à®¾?",
        "hi": "à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤•à¥à¤¯à¤¾ à¤†à¤ªà¤•à¥‹ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤šà¤¾à¤¹à¤¿à¤?",
        "ml": "à´¨à´®à´¸àµà´•à´¾à´°à´‚! à´¨à´¿à´™àµà´™àµ¾à´•àµà´•àµ à´¸à´¹à´¾à´¯à´‚ à´µàµ‡à´£à´®àµ‹?",
        "te": "à°¨à°®à°¸à±à°•à°¾à°°à°‚! à°®à±€à°•à± à°¸à°¹à°¾à°¯à°‚ à°•à°¾à°µà°¾à°²à°¾?",
        "en": "Hello! Do you need any help?"
    };

    // Student info
    const studentInfo = {
        "rollno": "{{ rollno }}",
        "name": "{{ name }}",
        "department": "{{ department }}",
        "marks": "{{ marks }}",
        "remarks": "{{ remarks }}"
    };

    // Keywords for questions & "yes" in each language
    const questionKeywords = {
        "ta": { "à®ªà¯†à®¯à®°à¯":"name","à®¤à¯à®±à¯ˆ":"department","à®®à®¤à®¿à®ªà¯à®ªà¯†à®£à¯":"marks","à®•à®°à¯à®¤à¯à®¤à¯":"remarks","à®°à¯‹à®²à¯":"rollno","à®†à®®à¯":"yes" },
        "hi": { "à¤¨à¤¾à¤®":"name","à¤µà¤¿à¤­à¤¾à¤—":"department","à¤…à¤‚à¤•":"marks","à¤Ÿà¤¿à¤ªà¥à¤ªà¤£à¥€":"remarks","à¤°à¥‹à¤²":"rollno","à¤¹à¤¾à¤":"yes" },
        "ml": { "à´ªàµ‡à´°àµ":"name","à´µà´¿à´­à´¾à´—à´‚":"department","à´®à´¾àµ¼à´•àµà´•àµ":"marks","à´…à´­à´¿à´ªàµà´°à´¾à´¯à´‚":"remarks","à´±àµ‹àµ¾":"rollno","à´…à´¤àµ†":"yes" },
        "te": { "à°ªà±‡à°°à±":"name","à°µà°¿à°­à°¾à°—à°‚":"department","à°®à°¾à°°à±à°•à±à°²à±":"marks","à°µà±à°¯à°¾à°–à±à°¯à°²à±":"remarks","à°°à±‹à°²à±":"rollno","à°…à°µà±à°¨à±":"yes" },
        "en": { "name":"name","department":"department","marks":"marks","remarks":"remarks","roll":"rollno","yes":"yes" }
    };

    // Speak function
    function speak(text) {
        audio.src = "/tts?text=" + encodeURIComponent(text) + "&lang=" + lang;
    }

    // Start voice recognition
    function startRecognition() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if(!SpeechRecognition) { alert("Your browser does not support speech recognition."); return; }

        const recognition = new SpeechRecognition();
        recognition.lang = lang; 
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.start();

        recognition.onresult = function(event) {
            const spoken = event.results[0][0].transcript.toLowerCase();
            handleParentResponse(spoken);
        };

        recognition.onerror = function(event) {
            console.log("Speech recognition error:", event.error);
            setTimeout(startRecognition, 1000); // Retry
        };

        recognition.onend = function() {
            setTimeout(startRecognition, 500); // Keep listening
        };
    }

    // Handle parent response
    function handleParentResponse(spoken) {
        const keywords = questionKeywords[lang];
        let answered = false;

        // Check for yes/full report first
        for(let key in keywords){
            if(spoken.includes(key)){
                if(keywords[key] === "yes"){
                    const fullReport = {
                        "ta": `à®°à¯‹à®²à¯ à®Žà®£à¯: ${studentInfo.rollno}, à®ªà¯†à®¯à®°à¯: ${studentInfo.name}, à®¤à¯à®±à¯ˆ: ${studentInfo.department}, à®®à®¤à®¿à®ªà¯à®ªà¯†à®£à¯: ${studentInfo.marks}, à®•à®°à¯à®¤à¯à®¤à¯: ${studentInfo.remarks}`,
                        "hi": `à¤°à¥‹à¤² à¤¨à¤‚à¤¬à¤°: ${studentInfo.rollno}, à¤¨à¤¾à¤®: ${studentInfo.name}, à¤µà¤¿à¤­à¤¾à¤—: ${studentInfo.department}, à¤…à¤‚à¤•: ${studentInfo.marks}, à¤Ÿà¤¿à¤ªà¥à¤ªà¤£à¥€: ${studentInfo.remarks}`,
                        "ml": `à´±àµ‹àµ¾ à´¨à´®àµà´ªàµ¼: ${studentInfo.rollno}, à´ªàµ‡à´°àµ: ${studentInfo.name}, à´µà´¿à´­à´¾à´—à´‚: ${studentInfo.department}, à´®à´¾àµ¼à´•àµà´•àµ: ${studentInfo.marks}, à´…à´­à´¿à´ªàµà´°à´¾à´¯à´‚: ${studentInfo.remarks}`,
                        "te": `à°°à±‹à°²à± à°¨à°‚à°¬à°°à±: ${studentInfo.rollno}, à°ªà±‡à°°à±: ${studentInfo.name}, à°µà°¿à°­à°¾à°—à°‚: ${studentInfo.department}, à°®à°¾à°°à±à°•à±à°²à±: ${studentInfo.marks}, à°µà±à°¯à°¾à°–à±à°¯à°²à±: ${studentInfo.remarks}`,
                        "en": `Roll Number: ${studentInfo.rollno}, Name: ${studentInfo.name}, Department: ${studentInfo.department}, Marks: ${studentInfo.marks}, Remarks: ${studentInfo.remarks}`
                    };
                    speak(fullReport[lang] || fullReport["en"]);
                    answered = true;
                    break;
                } else {
                    const infoKey = keywords[key];
                    const infoValue = studentInfo[infoKey];
                    speak(infoValue);
                    answered = true;
                    break;
                }
            }
        }

        if(!answered){
            // Default response
            const defaultResp = {
                "ta":"à®®à®©à¯à®©à®¿à®•à¯à®•à®µà¯à®®à¯, à®¨à®¾à®©à¯ à®°à¯‹à®²à¯ à®Žà®£à¯, à®ªà¯†à®¯à®°à¯, à®¤à¯à®±à¯ˆ, à®®à®¤à®¿à®ªà¯à®ªà¯†à®£à¯ à®®à®±à¯à®±à¯à®®à¯ à®•à®°à¯à®¤à¯à®¤à¯à®•à®³à¯ à®ªà®±à¯à®±à®¿ à®®à®Ÿà¯à®Ÿà¯à®®à¯‡ à®ªà®¤à®¿à®²à¯ à®•à¯‚à®±à®²à®¾à®®à¯.",
                "hi":"à¤®à¤¾à¤«à¤¼ à¤•à¤°à¥‡à¤‚, à¤®à¥ˆà¤‚ à¤•à¥‡à¤µà¤² à¤°à¥‹à¤² à¤¨à¤‚à¤¬à¤°, à¤¨à¤¾à¤®, à¤µà¤¿à¤­à¤¾à¤—, à¤…à¤‚à¤• à¤”à¤° à¤Ÿà¤¿à¤ªà¥à¤ªà¤£à¤¿à¤¯à¥‹à¤‚ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤œà¤µà¤¾à¤¬ à¤¦à¥‡ à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
                "ml":"à´•àµà´·à´®à´¿à´•àµà´•à´£à´‚, à´žà´¾àµ» à´±àµ‹àµ¾ à´¨à´®àµà´ªàµ¼, à´ªàµ‡à´°àµ, à´µà´¿à´­à´¾à´—à´‚, à´®à´¾àµ¼à´•àµà´•àµ, à´…à´­à´¿à´ªàµà´°à´¾à´¯à´™àµà´™àµ¾ à´¸à´‚à´¬à´¨àµà´§à´¿à´šàµà´šàµ à´®à´¾à´¤àµà´°à´®àµ‡ à´®à´±àµà´ªà´Ÿà´¿ à´¨àµ½à´•àµ‚.",
                "te":"à°•à±à°·à°®à°¿à°‚à°šà°‚à°¡à°¿, à°¨à±‡à°¨à± à°°à±‹à°²à± à°¨à°‚à°¬à°°à±, à°ªà±‡à°°à±, à°µà°¿à°­à°¾à°—à°‚, à°®à°¾à°°à±à°•à±à°²à± à°®à°°à°¿à°¯à± à°µà±à°¯à°¾à°–à±à°¯à°² à°—à±à°°à°¿à°‚à°šà°¿ à°®à°¾à°¤à±à°°à°®à±‡ à°œà°µà°¾à°¬à± à°‡à°µà±à°µà°—à°²à°¨à±.",
                "en":"Sorry, I can only answer about Roll Number, Name, Department, Marks, and Remarks."
            };
            speak(defaultResp[lang] || defaultResp["en"]);
        }
    }

    // Auto greet after 3 seconds
    setTimeout(() => { 
        speak(greetings[lang] || greetings["en"]);
    }, 3000);

    // Start listening after greeting
    setTimeout(startRecognition, 5000);
    </script>
</body>
</html>
